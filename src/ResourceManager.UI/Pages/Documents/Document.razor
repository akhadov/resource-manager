@page "/document/{DocumentId:guid}"
@using ResourceManager.Application.Documents.GetDocument
@using ResourceManager.Domain.Documents
@using ResourceManager.UI.Services.Interfaces
@inject IDocumentService _documentService
@inject NavigationManager _navigationManager

<MudText Typo="Typo.h3">Document Details</MudText>

@if (document != null)
{
    <MudPaper Class="p-4">
        <MudText Typo="Typo.h6">@document.Title</MudText>
        <MudText>@document.Content</MudText>
        <MudText Typo="Typo.body2" Color="Color.Secondary">Status: @document.Status</MudText>
        <MudText Typo="Typo.body2" Color="Color.Secondary">Created At: @document.CreatedAt.ToString("yyyy-MM-dd HH:mm:ss")</MudText>
        <MudText Typo="Typo.body2" Color="Color.Secondary">Updated At: @document.UpdatedAt?.ToString("yyyy-MM-dd HH:mm:ss")</MudText>

        <!-- Back button to return to the documents page -->
        <MudButton Color="Color.Secondary" Variant="Variant.Outlined" OnClick="GoBack">
            Back to Documents
        </MudButton>
    </MudPaper>
}
else if (isLoading)
{
    <MudCircularProgress Color="Color.Primary" Size="80" />
}
else
{
    <MudText Typo="Typo.h6" Color="Color.Error">Document not found.</MudText>
}

@code {
    [Parameter] public Guid DocumentId { get; set; } // Fetch DocumentId from the URL
    private DocumentResponse? document; // Store the document data
    private bool isLoading = true; // Loading state flag

    protected override async Task OnParametersSetAsync()
    {
        isLoading = true; // Set loading flag to true when the parameters are set
        try
        {
            document = await _documentService.GetDocument(DocumentId); // Fetch the document by its ID
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading document: {ex.Message}"); // Handle any errors in document retrieval
        }
        finally
        {
            isLoading = false; // Set loading flag to false once the data is fetched or an error occurs
        }
    }

    private void GoBack()
    {
        _navigationManager.NavigateTo("/documents"); // Navigate back to the documents page
    }
}
